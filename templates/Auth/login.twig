{% extends 'frontend_layout.twig' %}

{% block content %}
    <div class="content-lg container margin-t-40">
        <div class="row">
            <div class="col-sm-7" >
                <ul class="nav nav-tabs">
                    <li {{ currentRoute == 'login'    ? 'class="active"' }}><a data-toggle="tab" href="#signin">{{ 'Sign in'|trans }}</a></li>
                    <li {{ currentRoute == 'register' ? 'class="active"' }}><a data-toggle="tab" href="#signup">{{ 'Sign up'|trans }}</a></li>
                    <li {{ currentRoute == 'why_reg'  ? 'class="active"' }}><a data-toggle="tab" href="#why">{{ 'Why?'|trans }}</a></li>
                </ul>

                <div class="tab-content">
                    <div id="signin" class="tab-pane fade {{ currentRoute == 'login' ? 'in active' }}">
                        <form id="loginForm" method="post" data-toggle="validator" action="{{ path_for('login', {'lang': lang}) }}">
                            <h2 class="form-signin-heading">{{ 'Please sign in'|trans }}</h2>
                            <div class="form-group has-feedback">
                                <label class="sr-only" for="auth_login">{{ 'Login'|trans }}</label>
                                <input id="auth_login" name="login" class="form-control form" placeholder="{{ 'Login'|trans }}" required="" autofocus="" type="text" data-error="{{ 'Invalid value'|trans }}">
                                <span class="glyphicon glyphicon-user form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="sr-only" for="auth_password">{{ 'Password'|trans }}</label>
                                <input id="auth_password" name="password" class="form-control form" placeholder="{{ 'Password'|trans }}" required="" type="password" data-minlength="6" data-error="{{ 'Invalid value'|trans }}">
                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="checkbox">
                                <label>
                                    <input name="remember_me" value="remember-me" type="checkbox">
                                    {{ 'Remember me'|trans }}
                                </label>
                            </div>
                            <div class="form-group">
                                <button class="form-btn semibold" type="submit">{{ 'Sign in'|trans }}</button>
                            </div>
                        </form>
                        <a href="{{ path_for('forgotPassword', {'lang': lang}) }}">{{ 'I forgot my password'|trans }}</a>
                        <br><br>
                    </div>
                    <div id="signup" class="tab-pane fade {{ currentRoute == 'register' ? 'in active' }}">
                        <form id="registerForm" method="post" data-toggle="validator" action="{{ path_for('register', {'lang': lang}) }}">
                            <h2 class="form-signin-heading">{{ 'Registration'|trans }}</h2>

                            <div class="btn-group btn-toggle btn-group-justified" data-toggle="buttons" id="group_container">
                                <label class="btn btn-success active" data-toggle="collapse" data-target="#collapsible-b,#collapsible-s">
                                    <input name="group" value="2" type="radio"  checked=""> {{ 'Buyer'|trans }}
                                </label>
                                <label class="btn btn-default" data-toggle="collapse" data-target="#collapsible-b,#collapsible-s">
                                    <input name="group" value="3" type="radio" > {{ 'Supplier'|trans }}
                                </label>
                            </div>

                            <hr>

                            <div class="form-group">
                                <label for="name">{{ 'Company'|trans }} <span class="text-danger">*</span></label>
                                <input id="name" name="name" class="form-control form" placeholder="{{ 'Company'|trans }}" required="" type="text" data-error="{{ 'Invalid value'|trans }}">
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group foreign-company">
                                <label for="voen">VÖEN <span class="text-danger">*</span></label>
                                <input id="voen" name="voen" class="form-control form" placeholder="VÖEN" required="" type="text" pattern="[0-9]{10}" data-error="{{ 'Invalid value'|trans }}">
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group">
                                <label for="country">{{ 'Country'|trans }} <span class="text-danger">*</span></label>
                                <select id="country" name="country" class="form-control form select2" required=""></select>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group foreign-company">
                                <label for="city">{{ 'City'|trans }} <span class="text-danger">*</span></label>
                                <select id="city" name="city" class="form-control form select2" required="" data-error="{{ 'Select a city'|trans }}">
                                    <option value="" selected ></option>
                                    {% for city in cities %}
                                        <option value="{{ city.cityId }}">{{ city.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group has-feedback">
                                <label for="address">{{ 'Address'|trans }} <span class="text-danger">*</span></label>
                                <input id="address" name="address" class="form-control form" placeholder="{{ 'Address'|trans }}" type="text" required="" data-error="{{ 'Invalid value'|trans }}">
                                <span class="glyphicon glyphicon-map-marker form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group has-feedback">
                                <label for="phone">{{ 'Phone'|trans }} <span class="text-danger">*</span></label>
                                {#<input id="phone" name="phone" class="form-control form" placeholder="{{ 'Phone'|trans }}" required="" type="text" data-inputmask="'mask': '(999) 999-9999', 'autoUnmask': true, 'removeMaskOnSubmit': true" pattern="(\(0(12|18|20|21|22|23|24|25|26|36|50|51|55|70|77)\) [0-9]{3}-[0-9]{4})|0[0-9]{9}" >#}
                                <input id="phone" name="phone" class="form-control form" placeholder="{{ 'Phone'|trans }}" required="" type="text" >
                                <span class="glyphicon glyphicon-earphone form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group has-feedback">
                                <label for="email">Email <span class="text-danger">*</span></label>
                                <input id="email" name="email" class="form-control form" placeholder="Email" required="" type="email" data-error="{{ 'Invalid email'|trans }}" data-remote="{{ path_for('checkEmail', {'lang': lang}) }}">
                                <span class="glyphicon glyphicon-envelope form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group has-feedback">
                                <label class="sr-only" for="site">{{ 'Site'|trans }}</label>
                                <input id="site" name="site" class="form-control form" placeholder="{{ 'Site'|trans }}" type="url" data-error="{{ 'Invalid url'|trans }}">
                                <span class="glyphicon glyphicon-globe form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group has-feedback">
                                <label class="sr-only" for="facebook">{{ 'Facebook'|trans }}</label>
                                <input id="facebook" name="facebook" class="form-control form" placeholder="{{ 'Facebook'|trans }}" type="url" data-error="{{ 'Invalid url'|trans }}">
                                <span class="form-control-feedback fa fa-facebook" style="top: 10px"></span>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group">
                                <label class="sr-only" for="description">{{ 'Description'|trans }}</label>
                                <textarea id="description" name="description" class="form-control form" placeholder="{{ 'Description'|trans }}"></textarea>
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="collapse" id="collapsible-s">
                                <div class="form-group">
                                    <label for="industry">{{ 'Industry'|trans }}  <span class="text-danger">*</span></label>
                                    <select id="industry" name="industry[]" class="form-control form select2" multiple="multiple" required="" data-error="{{ 'Select an industry'|trans }}" data-validate="false">
                                        {% for industry in industries %}
                                            <option value="{{ industry.industryId }}">{{ industry.name }}</option>
                                        {% endfor %}
                                    </select>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>

                            <hr>

                            <div class="collapse in" id="collapsible-b">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        {{ 'Contacts'|trans }}
                                        <a class="pull-right text-success" href="javascript:void(0);" onclick="addContact()" title="{{ 'Append contact'|trans }}">
                                            <i class="fa fa-plus-circle fa-lg " aria-hidden="true"></i>
                                        </a>
                                    </div>
                                    <div class="panel-body">
                                        <div class="row fields-to-add">
                                            <div class="col-xs-11">
                                                <div class="form-group">
                                                    <label for="name">{{ 'Name'|trans }} <span class="text-danger">*</span></label>
                                                    <input name="contact_name[]" class="form-control form contact_info" placeholder="{{ 'Name'|trans }}" required="" type="text" data-error="{{ 'Invalid value'|trans }}" data-validate="true">
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="name">{{ 'Position'|trans }} <span class="text-danger">*</span></label>
                                                    <input name="contact_position[]" class="form-control form contact_info" placeholder="{{ 'Position'|trans }}" required="" type="text" data-error="{{ 'Invalid value'|trans }}" data-validate="true">
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="contact_phone">{{ 'Phone'|trans }} <span class="text-danger">*</span></label>
                                                    {#<input name="contact_phone[]" class="form-control form contact_info" placeholder="{{ 'Phone'|trans }}" required="" type="text" data-inputmask="'mask': '(999) 999-9999', 'autoUnmask': true, 'removeMaskOnSubmit': true" pattern="(\(0(12|18|20|21|22|23|24|25|26|36|50|51|55|70|77)\) [0-9]{3}-[0-9]{4})|0[0-9]{9}" data-validate="true" >#}
                                                    <input name="contact_phone[]" class="form-control form contact_info" placeholder="{{ 'Phone'|trans }}" required="" type="text" data-validate="true" >
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                                <div class="form-group">
                                                    <label for="email">Email <span class="text-danger">*</span></label>
                                                    <input name="contact_email[]" class="form-control form contact_info" placeholder="Email" required="" type="email" data-error="{{ 'Invalid email'|trans }}" data-validate="true">
                                                    <div class="help-block with-errors"></div>
                                                </div>
                                            </div>
                                            <div class="col-xs-1">
                                                <a href="javascript:void(0);" onclick="removeContact(this);" style="float: right; padding: 5px 5px 0 10px; display:none;" title="{{ 'Delete'|trans }}">
                                                    <i class="fa fa-remove"></i>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                            </div>
                            <div class="form-group has-feedback">
                                <label for="login">{{ 'Login'|trans }} <span class="text-danger">*</span></label>
                                <input id="login" name="login" class="form-control form" placeholder="{{ 'Login'|trans }}" required="" type="text" data-error="{{ 'Invalid value'|trans }}" data-remote="{{ path_for('checkLogin', {'lang': lang}) }}">
                                <span class="glyphicon glyphicon-user form-control-feedback"></span>
                                <div class="help-block with-errors"></div>
                            </div>
                            <div class="form-group has-feedback">
                                <label for="inputPassword">{{ 'Password'|trans }} <span class="text-danger">*</span></label>
                                <input id="inputPassword" name="password" class="form-control form" placeholder="{{ 'Password'|trans }}" required="" type="password" data-minlength="6" >
                                <span class="glyphicon glyphicon-lock form-control-feedback"></span>
                                <div class="help-block with-errors">{{ 'Minimum of 6 characters'|trans }}</div>
                            </div>
                            <div class="form-group">
                                <input type="password" class="form-control form" id="passwordConfirm" data-match="#inputPassword" data-error="{{ 'Password don\'t match'|trans }}" placeholder="{{ 'Confirm password'|trans }}" required="" >
                                <div class="help-block with-errors"></div>
                            </div>

                            <div class="form-group">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" id="terms" data-error="{{ 'You must first agree to the terms'|trans }}" required>
                                        {% set rules_link = '<a href="'~path_for('rules', {'lang': lang})~'">'~'terms and conditions'|trans~'</a>' %}
                                        {{ 'I understand, accept, and agree to the following %terms%.'|trans({'%terms%': rules_link})|raw }}
                                    </label>
                                    <div class="help-block with-errors"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <button class="form-btn semibold" type="submit">{{ 'Sign up'|trans }}</button>
                            </div>

                        </form>
                    </div>
                    <div id="why" class="tab-pane fade {{ currentRoute == 'why_reg' ? 'in active' }} niye">
                        <h2 class="form-signin-heading">{{ why_title }}</h2>
                        {{ why_text|raw }}
                    </div>
                </div>
            </div>
        </div>
    </div>

{% endblock %}

{% block head %}
    {{ parent() }}

    <link type="text/css" rel="stylesheet" href="{{ base_url() }}/resources/libs/select2/dist/css/select2.min.css?ver={{ version }}">
    <link type="text/css" rel="stylesheet" href="{{ base_url() }}/resources/libs/select2/dist/css/select2-bootstrap.min.css?ver={{ version }}">

{% endblock %}

{% block scripts %}
    {{ parent() }}

    <script src="{{ base_url() }}/resources/libs/select2/dist/js/select2.min.js?ver={{ version }}"></script>
    <script src="{{ base_url() }}/resources/libs/select2/dist/js/i18n/{{ lang }}.js?ver={{ version }}"></script>

    <script src="{{ base_url() }}/resources/js/select2Countries.js?ver={{ version }}"></script>

    <script src="{{ base_url() }}/resources/libs/Inputmask-4.x/dist/min/jquery.inputmask.bundle.min.js?ver={{ version }}"></script>


    <script src="{{ base_url() }}/resources/libs/bootstrap-validator/dist/validator.min.js?ver={{ version }}"></script>

    <script type="text/javascript">
        function addContact() {
            var elem = $('.fields-to-add').first().clone();

            elem.find('a').show();
            elem.find('input').val('');

            $('.fields-to-add').last().after(elem);

            //$('input[name="contact_phone[]"]').inputmask();

            $('#registerForm').validator('update');
        }
        function removeContact(selector) {
            $(selector).closest('.fields-to-add').remove();

            $('#registerForm').validator('update');
        }

        $(document).ready(function(){
	        $("[name='country']").on('change', function() {

	        	if($(this).val() == 'AZ'){
			        $('.foreign-company').show();
			        $('#voen').attr('data-validate', 'true').attr("disabled", false);
			        $('#city').attr('data-validate', 'true').attr("disabled", false);
                }else{
			        $('.foreign-company').hide();

			        $('#voen').attr('data-validate', 'false').attr("disabled", true);
			        $('#city').attr('data-validate', 'false').attr("disabled", true);
                }

		        $('#registerForm').validator('update');
            });

            $('#city').select2({
                placeholder: "{{ 'Select a city'|trans }}",
                theme: "bootstrap",
                width: '100%',
            });
            $('#industry').select2({
                placeholder: "{{ 'Select an industry'|trans }}",
                theme: "bootstrap",
                width: '100%',
                tags: true,
            });

            //$('#phone').inputmask();
            //$('input[name="contact_phone[]"]').inputmask();

            $('#registerForm').validator('update');


            $('.btn-toggle').click(function() {
                $(this).find('.btn').toggleClass('active');

                if ($(this).find('.btn-primary').length > 0) {
                    $(this).find('.btn').toggleClass('btn-primary');
                }
                if ($(this).find('.btn-danger').length > 0) {
                    $(this).find('.btn').toggleClass('btn-danger');
                }
                if ($(this).find('.btn-success').length > 0) {
                    $(this).find('.btn').toggleClass('btn-success');
                }
                if ($(this).find('.btn-info').length > 0) {
                    $(this).find('.btn').toggleClass('btn-info');
                }

                $(this).find('.btn').toggleClass('btn-default');
            });

            $('#group_container').on( "click", function() {
                if($('#collapsible-s').css('display') == 'none'){
                    $('#industry').attr('data-validate', 'true').attr("disabled", false);
                    $('.contact_info').attr('data-validate', 'false').attr("disabled", true);

                    $('#registerForm').validator('update');
                }else{
                    $('#industry').attr('data-validate', 'false').attr("disabled", true);
                    $('.contact_info').attr('data-validate', 'true').attr("disabled", false);

                    $('#registerForm').validator('update');
                }
            });

        });
    </script>
{% endblock %}